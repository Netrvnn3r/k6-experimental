/**
 * K6 Performance Test â€” Auto-generated from BDD Feature
 * 
 * Feature: NavegaciÃ³n y BÃºsqueda de Productos
 * Scenario: Test de carga de navegaciÃ³n de productos [Load Test â€” Row 1]
 * Examples: Load Test
 * Parameters: {"vus":"15","duration":"2m","page":"1","pageSize":"20","searchTerm":"Laptop","category":"Computers","threshold_p95":"2000","threshold_search":"2000","failure_rate":"5"}
 * 
 * Generated at: 2026-02-18T14:54:53.972Z
 * âš ï¸  DO NOT EDIT â€” This file is auto-generated by the BDD runner.
 *     Edit the .feature file and step definitions instead.
 */

import { sleep } from 'k6';
import http from 'k6/http';
import { check } from 'k6';
import { Trend } from 'k6/metrics';
import { BASE_URL } from '../../lib/config.js';
import { login } from '../../lib/auth.js';
import { getProducts } from '../../lib/endpoints.js';
import { randomThinkTime, getTimestamp } from '../../lib/helpers.js';
import { htmlReport } from 'https://raw.githubusercontent.com/benc-uk/k6-reporter/main/dist/bundle.js';
import { textSummary } from 'https://jslib.k6.io/k6-summary/0.1.0/index.js';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CUSTOM METRICS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const productListDuration = new Trend('product_list_duration', true);
const productSearchDuration = new Trend('product_search_duration', true);
const categoryFilterDuration = new Trend('category_filter_duration', true);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// OPTIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export const options = {
    "scenarios": {
        "test_de_carga_de_navegaci_n_de_productos": {
            "executor": "ramping-vus",
            "startVUs": 1,
            "stages": [
                {
                    "duration": "24s",
                    "target": 15
                },
                {
                    "duration": "78s",
                    "target": 15
                },
                {
                    "duration": "18s",
                    "target": 0
                }
            ]
        }
    },
    "thresholds": {
        "product_list_duration": [
            "p(95)<2000"
        ],
        "product_search_duration": [
            "p(95)<2000"
        ],
        "http_req_failed": [
            "rate<0.05"
        ]
    }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SETUP
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export function setup() {
    const token = login();
    if (!token) throw new Error('Authentication failed during setup.');
    return { token };
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DEFAULT â€” Test de carga de navegaciÃ³n de productos [Load Test â€” Row 1]
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export default function (data) {
    // AutenticaciÃ³n via setup()
    const { token } = data;
    if (!token) { console.error('âŒ No token available'); return; }

    // Browse products â€” page: 1, pageSize: 20
    const browseStart = Date.now();
    const browseResult = getProducts(data.token, { page: 1, pageSize: 20 });
    productListDuration.add(Date.now() - browseStart);
    if (browseResult && browseResult.data) {
        console.log(`ğŸ“¦ Productos: ${browseResult.data.total} total`);
    }
    sleep(randomThinkTime(1, 2));

    // Search products: "Laptop"
    const searchStart = Date.now();
    const searchResult = getProducts(data.token, { search: 'Laptop', page: 1, pageSize: 10 });
    productSearchDuration.add(Date.now() - searchStart);
    if (searchResult && searchResult.data) {
        console.log(`ğŸ” BÃºsqueda "Laptop": ${searchResult.data.total} resultados`);
    }
    sleep(randomThinkTime(0.5, 1));

    // Filter by category: "Computers"
    const filterStart = Date.now();
    const filterResult = getProducts(data.token, { category: 'Computers', page: 1, pageSize: 10 });
    categoryFilterDuration.add(Date.now() - filterStart);
    if (filterResult && filterResult.data) {
        console.log(`ğŸ·ï¸ CategorÃ­a "Computers": ${filterResult.data.total} resultados`);
    }
    sleep(randomThinkTime(0.5, 1));

    // Threshold assertion: products p95 < 2000ms

    // Threshold assertion: search p95 < 2000ms

    // Threshold assertion: failure rate < 5% (enforced via k6 thresholds)
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TEARDOWN
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export function teardown(data) {
    console.log('ğŸ Test BDD completado: Test de carga de navegaciÃ³n de productos [Load Test â€” Row 1]');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// REPORT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export function handleSummary(data) {
    const ts = getTimestamp();
    return {
        [`reports/bdd-test-de-carga-de-navegaci-n-de-productos-load-test-row-1_${ts}.html`]: htmlReport(data),
        [`reports/bdd-test-de-carga-de-navegaci-n-de-productos-load-test-row-1_${ts}.json`]: JSON.stringify(data, null, 2),
        stdout: textSummary(data, { indent: ' ', enableColors: true }),
    };
}