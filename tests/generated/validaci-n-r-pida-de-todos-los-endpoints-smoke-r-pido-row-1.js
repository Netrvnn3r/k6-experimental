/**
 * K6 Performance Test â€” Auto-generated from BDD Feature
 * 
 * Feature: Smoke Test General
 * Scenario: ValidaciÃ³n rÃ¡pida de todos los endpoints [Smoke rÃ¡pido â€” Row 1]
 * Examples: Smoke rÃ¡pido
 * Parameters: {"vus":"1","duration":"10s","searchTerm":"Phone","threshold_general":"3000"}
 * 
 * Generated at: 2026-02-18T14:54:53.975Z
 * âš ï¸  DO NOT EDIT â€” This file is auto-generated by the BDD runner.
 *     Edit the .feature file and step definitions instead.
 */

import { sleep } from 'k6';
import http from 'k6/http';
import { check } from 'k6';
import { Trend } from 'k6/metrics';
import { BASE_URL } from '../../lib/config.js';
import { login } from '../../lib/auth.js';
import { getProducts, getUsers, getOrders } from '../../lib/endpoints.js';
import { randomThinkTime, getTimestamp } from '../../lib/helpers.js';
import { htmlReport } from 'https://raw.githubusercontent.com/benc-uk/k6-reporter/main/dist/bundle.js';
import { textSummary } from 'https://jslib.k6.io/k6-summary/0.1.0/index.js';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CUSTOM METRICS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const productListDuration = new Trend('product_list_duration', true);
const productSearchDuration = new Trend('product_search_duration', true);
const userListDuration = new Trend('user_list_duration', true);
const orderListDuration = new Trend('order_list_duration', true);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// OPTIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export const options = {
    "vus": 1,
    "iterations": 1,
    "thresholds": {
        "http_req_failed": [
            "rate<0.10"
        ],
        "http_req_duration": [
            "p(95)<3000"
        ]
    }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SETUP
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export function setup() {
    const token = login();
    if (!token) throw new Error('Authentication failed during setup.');
    return { token };
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DEFAULT â€” ValidaciÃ³n rÃ¡pida de todos los endpoints [Smoke rÃ¡pido â€” Row 1]
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export default function (data) {
    // AutenticaciÃ³n via setup()
    const { token } = data;
    if (!token) { console.error('âŒ No token available'); return; }

    // Browse products â€” page: 1, pageSize: 10
    const browseStart = Date.now();
    const browseResult = getProducts(data.token, { page: 1, pageSize: 10 });
    productListDuration.add(Date.now() - browseStart);
    if (browseResult && browseResult.data) {
        console.log(`ğŸ“¦ Productos: ${browseResult.data.total} total`);
    }
    sleep(randomThinkTime(1, 2));

    // Search products: "Phone"
    const searchStart = Date.now();
    const searchResult = getProducts(data.token, { search: 'Phone', page: 1, pageSize: 10 });
    productSearchDuration.add(Date.now() - searchStart);
    if (searchResult && searchResult.data) {
        console.log(`ğŸ” BÃºsqueda "Phone": ${searchResult.data.total} resultados`);
    }
    sleep(randomThinkTime(0.5, 1));

    // List users
    const usersStart = Date.now();
    const usersResult = getUsers(data.token, { page: 1, pageSize: 10 });
    userListDuration.add(Date.now() - usersStart);
    if (usersResult && usersResult.data) {
        console.log(`ğŸ‘¥ Usuarios: ${usersResult.data.total} total`);
    }
    sleep(1);

    // List orders
    const ordersStart = Date.now();
    const ordersResult = getOrders(data.token, { page: 1, pageSize: 10 });
    orderListDuration.add(Date.now() - ordersStart);
    if (ordersResult && ordersResult.data) {
        console.log(`ğŸ“‹ Ã“rdenes: ${ordersResult.data.total} total`);
    }
    sleep(1);

    // Assertion: all endpoints responded correctly (enforced via checks)

    // Threshold assertion: overall response time p95 < 3000ms
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TEARDOWN
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export function teardown(data) {
    console.log('ğŸ Test BDD completado: ValidaciÃ³n rÃ¡pida de todos los endpoints [Smoke rÃ¡pido â€” Row 1]');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// REPORT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export function handleSummary(data) {
    const ts = getTimestamp();
    return {
        [`reports/bdd-validaci-n-r-pida-de-todos-los-endpoints-smoke-r-pido-row-1_${ts}.html`]: htmlReport(data),
        [`reports/bdd-validaci-n-r-pida-de-todos-los-endpoints-smoke-r-pido-row-1_${ts}.json`]: JSON.stringify(data, null, 2),
        stdout: textSummary(data, { indent: ' ', enableColors: true }),
    };
}